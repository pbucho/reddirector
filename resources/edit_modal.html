<div id="edit_modal" class="modal fade" role="dialog" data-backdrop="static">
  <div class="modal-dialog">
    <div class="form-horizontal">
      <div class="modal-content">
        <div class="modal-header">
          <button id="btn_cross" type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Edit URL</h4>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="control-label col-sm-3" for="long_url">Long URL:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ed_long_url" name="long_url" placeholder="Long URL" required>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-3" for="short_url">String:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ed_short_url_disabled" name="short_url_disabled" placeholder="String" data-toggle="tooltip" title="You can't change this field" disabled="true">
              <input type="hidden" id="ed_short_url" name="short_url">
              <input type="hidden" name="operation" value="1">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <i id="spinner" class="fa fa-circle-o-notch fa-spin" style="display: none"></i>&nbsp;&nbsp;
          <button id="btn_cancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button id="btn_ok" type="button" class="btn btn-primary" onclick="submit()">OK</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src="/js/cookie_getter.js"></script>
<script type="text/javascript">
  $("#ed_long_url").keyup(function(event){
    if(event.keyCode == 13){
      submit();
    }
  });
  function submit() {
    var token = getToken();
    if(token == null) {
      alert("An error occurred. Please log in again.");
      return;
    }
    var req = new XMLHttpRequest();
    var connection = "/api/modify.php?token="+token+"&shorturl="+$("#ed_short_url").val()+"&longurl="+encodeURI($("#ed_long_url").val());
    req.open("GET", connection, true);
    req.onreadystatechange = function() {
      if(req.readyState == 4 && req.status == 200){
        var response = JSON.parse(req.responseText);
        if(response['success']){
          location.reload();
        }else{
          alert("Could not edit URL: "+response['reason']);
          $("#btn_cross").attr("disabled", false);
          $("#btn_cancel").attr("disabled", false);
          $("#btn_ok").attr("disabled", false);
          $("#ed_long_url").attr("disabled", false);
          $("#spinner").hide();
        }
      }
    };
    $("#btn_cross").attr("disabled", true);
    $("#btn_cancel").attr("disabled", true);
    $("#btn_ok").attr("disabled", true);
    $("#ed_long_url").attr("disabled", true);
    $("#spinner").show();
    req.send();
  }
</script>
